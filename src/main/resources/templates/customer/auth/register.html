<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Đăng ký - ActurusBooks</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet" />
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
    <!-- Select2 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css"
        rel="stylesheet" />
    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/index.css">
</head>

<body>
    <!-- Header/Navbar giữ nguyên -->
    <div th:replace="~{fragments/navbar-customer :: navbar}"></div>
    <!-- Nội dung đăng nhập/đăng ký -->
    <section class="auth-section py-5" style="background:#f8f9fa;">
        <div class="container">
            <div class="row justify-content-center">
                <!-- Đăng ký -->
                <div class="col-md-5">
                    <div class="card shadow-sm mb-4">
                        <div class="card-body">
                            <h4 class="mb-3 text-center">Đăng ký</h4>

                            <!-- Error message -->
                            <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
                                <i class="bi bi-exclamation-triangle-fill me-2"></i>
                                <span th:text="${error}"></span>
                                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                            </div>

                            <!-- Success message -->
                            <div th:if="${success}" class="alert alert-success alert-dismissible fade show"
                                role="alert">
                                <i class="bi bi-check-circle-fill me-2"></i>
                                <span th:text="${success}"></span>
                                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                            </div>

                            <form th:action="@{/register}" method="post" th:object="${user}">
                                <div class="mb-3">
                                    <label for="registerName" class="form-label">Họ và tên</label>
                                    <input type="text" class="form-control" id="registerName" placeholder="Nhập họ tên"
                                        th:field="*{full_name}">
                                </div>
                                <div class="mb-3">
                                    <label for="username" class="form-label">Tên đăng nhập</label>
                                    <input type="text" class="form-control" id="username" th:field="*{username}"
                                        required>
                                </div>
                                <div class="mb-3">
                                    <label for="registerEmail" class="form-label">Email</label>
                                    <input type="email" class="form-control" id="registerEmail" placeholder="Nhập email"
                                        th:field="*{email}" required>
                                </div>
                                <div class="mb-3">
                                    <label for="registerPassword" class="form-label">Mật khẩu</label>
                                    <input type="password" class="form-control" id="registerPassword"
                                        placeholder="Nhập mật khẩu" th:field="*{password}" required>
                                </div>
                                <div class="mb-3">
                                    <label for="registerPassword2" class="form-label">Nhập lại mật khẩu</label>
                                    <input type="password" class="form-control" id="registerPassword2"
                                        placeholder="Nhập lại mật khẩu">
                                </div>
                                <div class="mb-3">
                                    <label for="registerPhone" class="form-label">Số điện thoại</label>
                                    <input type="text" class="form-control" id="registerPhone"
                                        placeholder="Nhập số điện thoại" th:field="*{phone}">
                                </div>

                                <!-- Địa chỉ theo 34 tỉnh thành -->
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="province" class="form-label">Tỉnh/Thành phố <span
                                                class="text-danger">*</span></label>
                                        <select class="form-select" id="province" required>
                                            <option value="">Chọn Tỉnh/Thành phố</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="ward" class="form-label">Phường/Xã <span
                                                class="text-danger">*</span></label>
                                        <select class="form-select" id="ward" required disabled>
                                            <option value="">Chọn Phường/Xã</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="registerAddress" class="form-label">Địa chỉ chi tiết</label>
                                    <input type="text" class="form-control" id="registerAddress"
                                        placeholder="Số nhà, tên đường..." th:field="*{address}">
                                </div>

                                <!-- Hidden field để lưu địa chỉ đầy đủ -->
                                <input type="hidden" id="fullAddress" th:field="*{address}">
                                <button type="submit" class="btn btn-dark w-100">Đăng ký</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer giữ nguyên -->
    <footer class="footer py-5">
        <div class="container">
            <!-- Thay thế phần footer trong cả hai file -->
            <footer class="footer py-5">
                <div class="container">
                    <div class="row g-4 text-dark">
                        <!-- Column 1 -->
                        <div class="col-md-2">
                            <h5 class="fw-bold">Thể Loại</h5>
                            <ul class="list-unstyled">
                                <li><a href="#">Truyện tranh</a></li>
                                <li><a href="#">Văn học</a></li>
                                <li><a href="#">Kinh tế</a></li>
                                <li><a href="#">Thiếu nhi</a></li>
                                <li><a href="#">Kỹ năng sống</a></li>
                            </ul>
                        </div>
                        <!-- Column 2 -->
                        <div class="col-md-2">
                            <h5 class="fw-bold">Tài Khoản</h5>
                            <ul class="list-unstyled">
                                <li><a href="register.html">Đăng ký</a></li>
                                <li><a href="login.html">Đăng nhập</a></li>
                                <li><a href="#">Giỏ hàng</a></li>
                                <li><a href="#">Yêu thích</a></li>
                                <li><a href="#">So sánh sách</a></li>
                            </ul>
                        </div>
                        <!-- Column 3 -->
                        <div class="col-md-2">
                            <h5 class="fw-bold">Về Chúng Tôi</h5>
                            <ul class="list-unstyled">
                                <li><a href="#">Giới thiệu</a></li>
                                <li><a href="#">Liên hệ</a></li>
                                <li><a href="#">Hệ thống nhà sách</a></li>
                                <li><a href="#">Blog</a></li>
                                <li><a href="#">FAQ</a></li>
                            </ul>
                        </div>
                        <!-- Column 4 -->
                        <div class="col-md-2">
                            <h5 class="fw-bold">Dịch Vụ</h5>
                            <ul class="list-unstyled">
                                <li><a href="#">Lịch sử đơn hàng</a></li>
                                <li><a href="#">Hỗ trợ khách hàng</a></li>
                                <li><a href="#">Điều khoản</a></li>
                                <li><a href="#">Đổi trả</a></li>
                                <li><a href="#">Giao hàng</a></li>
                            </ul>
                        </div>
                        <!-- Column 5 - Newsletter -->
                        <div class="col-md-4">
                            <div class="newsletter-box text-center">
                                <h5 class="fw-bold">Đăng Ký Nhận Tin</h5>
                                <p>Nhận ưu đãi <strong>10%</strong> cho đơn hàng đầu tiên khi đăng ký email.</p>
                                <form class="newsletter-form">
                                    <input type="email" class="form-control" placeholder="Nhập email của bạn..."
                                        required>
                                    <button type="submit" class="newsletter-btn">
                                        <i class="bi bi-arrow-right"></i>
                                    </button>
                                </form>
                                <div class="payment-icons mt-3">
                                    <i class="bi bi-paypal"></i>
                                    <i class="bi bi-cc-visa"></i>
                                    <i class="bi bi-credit-card"></i>
                                    <i class="bi bi-amazon"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </footer>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"></script>
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Select2 JS -->
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

    <script>
        // Password confirmation validation
        document.addEventListener('DOMContentLoaded', function () {
            const form = document.querySelector('form');
            const password = document.getElementById('registerPassword');
            const confirmPassword = document.getElementById('registerPassword2');

            form.addEventListener('submit', function (e) {
                if (password.value !== confirmPassword.value) {
                    e.preventDefault();

                    // Remove existing error if any
                    const existingError = document.querySelector('.password-error');
                    if (existingError) {
                        existingError.remove();
                    }

                    // Add error message
                    const errorDiv = document.createElement('div');
                    errorDiv.className = 'alert alert-danger password-error mt-3';
                    errorDiv.innerHTML = '<i class="bi bi-exclamation-triangle-fill me-2"></i>Mật khẩu xác nhận không khớp!';

                    confirmPassword.parentNode.appendChild(errorDiv);
                    confirmPassword.focus();

                    // Auto hide error after 5 seconds
                    setTimeout(() => {
                        if (errorDiv) {
                            errorDiv.remove();
                        }
                    }, 5000);
                }
            });

            // Real-time password validation
            confirmPassword.addEventListener('input', function () {
                const existingError = document.querySelector('.password-error');
                if (existingError && password.value === confirmPassword.value) {
                    existingError.remove();
                }
            });
        });

        // 34 Tỉnh thành API integration
        $(document).ready(function () {
            // Initialize Select2 for provinces
            $('#province').select2({
                theme: 'bootstrap-5',
                placeholder: 'Tìm kiếm và chọn Tỉnh/Thành phố...',
                allowClear: true,
                width: '100%'
            });

            $('#ward').select2({
                theme: 'bootstrap-5',
                placeholder: 'Tìm kiếm và chọn Phường/Xã...',
                allowClear: true,
                width: '100%'
            });

            // Load provinces from API
            loadProvinces();

            // Province change event
            $('#province').on('change', function () {
                const provinceCode = $(this).val();
                if (provinceCode) {
                    loadWards(provinceCode);
                } else {
                    $('#ward').empty().append('<option value="">Chọn Phường/Xã</option>').prop('disabled', true);
                }
                updateFullAddress();
            });

            // Ward change event
            $('#ward').on('change', function () {
                updateFullAddress();
            });

            // Detail address change event
            $('#registerAddress').on('input', function () {
                updateFullAddress();
            });

            // Load provinces function
            function loadProvinces() {
                $.get('https://34tinhthanh.com/api/provinces')
                    .done(function (data) {
                        $('#province').empty().append('<option value="">Chọn Tỉnh/Thành phố</option>');

                        if (data && Array.isArray(data)) {
                            data.forEach(function (province) {
                                $('#province').append($('<option>', {
                                    value: province.province_code,
                                    text: province.name,
                                    'data-name': province.name
                                }));
                            });
                        }
                    })
                    .fail(function () {
                        console.error('Không thể tải danh sách tỉnh thành');
                        $('#province').append('<option value="">Lỗi tải dữ liệu</option>');
                    });
            }

            // Load wards function
            function loadWards(provinceCode) {
                $.get(`https://34tinhthanh.com/api/wards?province_code=${provinceCode}`)
                    .done(function (data) {
                        $('#ward').empty().append('<option value="">Chọn Phường/Xã</option>');

                        if (data && Array.isArray(data)) {
                            data.forEach(function (ward) {
                                $('#ward').append($('<option>', {
                                    value: ward.ward_code,
                                    text: ward.ward_name,
                                    'data-name': ward.ward_name
                                }));
                            });
                            $('#ward').prop('disabled', false);
                        }
                    })
                    .fail(function () {
                        console.error('Không thể tải danh sách phường xã');
                        $('#ward').append('<option value="">Lỗi tải dữ liệu</option>');
                    });
            }

            // Update full address function
            function updateFullAddress() {
                const detailAddress = $('#registerAddress').val();
                const wardText = $('#ward option:selected').data('name') || '';
                const provinceText = $('#province option:selected').data('name') || '';

                let fullAddress = '';
                if (detailAddress) fullAddress += detailAddress;
                if (wardText) fullAddress += (fullAddress ? ', ' : '') + wardText;
                if (provinceText) fullAddress += (fullAddress ? ', ' : '') + provinceText;

                $('#fullAddress').val(fullAddress);
            }
        });
    </script>
</body>

</html>